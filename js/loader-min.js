// a/sync script loader, 2013 joe nudell
function Loader(b){var c=this,d={async:true,event:"loaded",wait:false};for(var a in b){d[a]=b[a]}this.options=d;this._listeners={loaded:[]};this._pending=[]}Loader.prototype.trigger=function(b){if(this._listeners[b]){for(var a=0;a<this._listeners[b].length;a++){this._listeners[b][a]()}return true}return false};Loader.prototype.listenOnce=function(c,a){var b=this;this.addListener(c,function d(){a();b.removeListener(c,this)})};Loader.prototype.addListener=function(b,a){if(!this._listeners[b]){this._listeners[b]=[]}this._listeners[b].push(a)};Loader.prototype.removeListener=function(d,c){if(this._listeners[d]){var b=this._listeners[d];for(var a=0;a<b.length;a++){if(String(c)===String(b[a])){b.splice(a,1);return true}}}return false};Loader.prototype.loadFiles=function(b,o){var k=this,o=o||{},i=0,m=0,g=(o.async===undefined)?this.options.async:o.async,n=o.callback||function(){return},c=o.event||this.options.event,j=o.wait||this.options.wait,d=""+Date.now(),a=function(e){return document.querySelector(e)},h=function(){k.trigger(c);for(var e=0;e<k._pending.length;e++){if(k._pending[e]===d){k._pending.splice(e,1)}}k.trigger(d);n()};this._pending.push(d);function f(e){if(!(e||[]).length){if(!m){h()}return}var p=null,q=e.shift();if(/\.js$/.test(q)||/\.js\?/.test(q)||/^js!/.test(q)){if(!a('script[src="'+q+'"]')){p=document.createElement("script");p.setAttribute("type","text/javascript");p.setAttribute("src",q)}}else{if(/\.css$/.test(q)||/^css!/.test(q)){if(!a('link[href="'+q+'"]')){p=document.createElement("link");p.setAttribute("rel","stylesheet");p.setAttribute("type","text/css");p.setAttribute("href",q)}}else{console.warn("Loader: can't determine type of "+q)}}if(p!=null){p.addEventListener("load",function(r){i++;if(!g){f(e)}if(i==m){h()}});m++;document.getElementsByTagName("head")[0].appendChild(p)}else{if(!g){f(e)}}if(g){f(e)}}if((!g||j)&&this._pending.length>1){var l=this._pending[this._pending.length-2];this.listenOnce(l,function(){f(b)})}else{f(b)}};